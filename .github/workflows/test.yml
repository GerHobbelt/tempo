name: test

on:
  push:
    branches:
      - main
      - release-*
    tags:        
      - v[0-9]+.[0-9]+.[0-9]+
    paths:
      - 'docs/tempo/website/**'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:

      # Fetch tags
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
 
      - name: Checkout Actions
        uses: actions/checkout@v2
        with:
          repository: "grafana/grafana-github-actions"
          path: ./actions
          ref: jdb/2022-04-has-matching-release-tag

      - name: Install Actions
        run: npm install --production --prefix ./actions

      - name: Determine if there is a matching release tag
        id: has-matching-release-tag
        uses: ./actions/has-matching-release-tag
        with:
          ref_name: "${{ github.ref_name }}"
          release_tag_regexp: "^release-\\d+\\.\\d+\\.\\d+$"
          release_branch_regexp: "^release-\\d+\\.\\d+$"

      - id:   target
        if: "steps.has-matching-release-tag.outputs.bool == 'true'"        
        name: Get target
        uses: ./actions/docs-target
        with:
          ref_name: ${{ github.ref_name }}

      - shell: bash
        if: "steps.has-matching-release-tag.outputs.bool == 'true'"        
        run: |
          echo "action returned " ${{ steps.target.outputs.target }} 